<!DOCTYPE html>
<html lang="en-us">
<head>
   <meta charset="UTF-8">
   <title>Orchestra, by St Joseph Content</title>
   <meta name="viewport" content="width=device-width, initial-scale=1">
   <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
   <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
   <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
   <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
</head>

<body>
   <section class="page-header">
      <h1 class="project-name">Orchestra</h1>
      <h2 class="project-tagline">Making web application deployment easy, cheap, fast, and banana</h2>
      <a href="https://github.com/stjosephcontent/orchestra" class="btn">View on GitHub</a>
      <a href="https://github.com/stjosephcontent/orchestra/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/stjosephcontent/orchestra/tarball/master" class="btn">Download .tar.gz</a>
   </section>

   <section class="main-content">

      <h3>Orchestra</h3>
      <blockquote>Orchestra is a set of tools that work together make deploying and scaling web apps easy, fast, and cheap.</blockquote>

      <p>Most modern web applications comprise multiple core technologies including web servers, application servers, database servers, APIs, and 3rd party services. Orchestra was created to deploy and scale apps made up of these components elegantly. It can deploy multiple web applications made up of multiple services, from multiple branches of multiple Git repositories, to multiple targets, making it an ideal tool for developers and DevOps.</p>
      <p>The concept is akin to a symphony, composed of multiple sections, which are made up of multiple players, all culminating in multiple orgasms.</p>

      <h4>Concepts</h4>
      <p>The root level for Orchestra is the <em>Project</em>. A project can be thought of as group of one or more <em>Applications</em>. Applications are made up of <em>services</em>, with each service sharing a one-to-one relationship with a Docker container. A simple real-world example of this would be a self-hosted WordPress installation for a personal recipe site called <em>MyRecipes</em>. <em>MyRecipes</em> would be the project that contains an application called <em>website</em>. The <em>website</em> application contains two services, one called <em>PHP</em> and the other <em>MySQL</em>. Since services are 1:1 with Docker containers this means our project is composed of two Docker containers. Now, if we want to add a custom recipe uploader based on a cool NodeJS web-service, we add a new application to the project called <em>recipe-api</em>. This application contains a single service called <em>NodeJS</em> which again, has a one-to-one relationship with a Docker container.</p>

      <p><img src="orchestra.png" /></p>

      <p>Let’s go into greater detail on Projects, Applications, Refs, and Services...</p>

      <h5>Project</h5>

      <p>A project is a way to group and namespace related applications. As such, it is lightweight. As far as meta-data tracking and includes:
      <dl>
         <dt>name</dt>
         <dd>A short, legible, semantic, meaningful name</dd>
         <dt>slug</dt>
         <dd>a safe, machine-readble version of the name, composed of URL-safe characters (used in REST calls to the Application Registry API)</dd>
         <dt>description</dt>
         <dd>A description of the project, for humans</dd>
         <dt>tags</dt>
         <dd>An array of tags helpful in searching by the Application Registry API.</dd>
         <dt>homepage</dt>
         <dd>A landing page with a synopsis of the project and links to each application repo and optional documentation wiki (e.g. <a href="http://stjosephcontent.github.io/orchestra/">Orchestra</a>.) plus the applications defined in the next section.</dd>
      </dl>
      </p>

      <h5>Application</h5>
      <p>This is the main focus of operations performed by SJC CLI and App Registry. The system will normally think in terms of Applications and Instances. An Application can be thought of as all the files in that repo plus all the information in the appdef.yml file that sits at it's root. An Application can contain 1 or more services (in the future, we may support zero-service applications). Each application shares a 1:1 relationship with a Git repository.</p>

      <h5>Ref</h5>
      <p>This system needs git. Like git, you have to be in a working directory to invoke commands on that app. Orchestra uses git's method of identifying a specific commit. Hence, it will usually deal with branches, but can work in "detached head" mode as well and refer unambiguously to commits by their sha1 ID. You can think of a ref as simply an Application in a definite, identifiable state.</p>


      <h5>Service</h5>
      <p>A Service is a Docker Container in addition to an agreed upon name (and some other metadata). For example, a Django service will contain a Dockerfile, the name "django", which allows other services to know how to link to it, and some information on how it should be run (like in a docker-compose.yml file). One of the Services is designated the "ambassador", which is how Orchestra knows which Service to assign an ephemeral port to, and to expose it's reverse proxy to. The "services" section of appdef.yml follows closely the docker-compose.yml format. This is by design. Indeed, appdef.yml can be seen as a superset of docker-compose.yml.</p>


      <h5>Target</h5>
      <p>A Target is a host, or a cluster of hosts acting as one. Targets contain information on how to "unpack" the docker app, and that information can vary from one Target to another (ex: A production endpoint will unpack an app and replace the MySQL service with RDS credentials. A staging server may do the same, but with different credentials. Another target may simply spin up the containers unmolested).</p>


      <h5>Instance</h5>
      <p>An Instance is what happens when a Ref is pushed to a Target. An Instance has a unique and <em>predictable</em> URL, in addition to a unique and <em>unpredictable</em> ephermal port. It's address can be composed as <code>Project.slug + Application.slug + Ref + Target.endpoint</code>. ( ie: <em>cerebrum.cms.CE-99-add-footer.staging.sjc.io</em> ). The ephemeral port is used internally, and is not needed to construct an instance’s address.</p>
         
      <img src="conceptual_arch.png" alt="Concepts in Orchestra" />
      <h4>Components</h4>

      <h5><a href="https://github.com/stjosephcontent/sjc-cli">Command Line Interface</a></h5>
      <p>
         The CLI is for invoking common commands. It's API and usage is inspired by CLIs like npm, git, docker, docker-compose, rsync, and ssh. Indeed most of it's actions invoke one or more of those utilities.
      </p>
      <p>
         The command line interface is implemented in NodeJS 4.0 and communicates directly with the Docker daemon. All project definitions, dependencies, host information, docker files, etc are retrieved from a central registry.
      </p>

      <h5><a href="https://github.com/stjosephcontent/app-registry">Application Registry</a></h5>
      <p>
         This is a central service that acts as a global registry, keeping track of what applications in what state have been deployed to what endpoints. Every app declares it's features and properties with an appdef.yml file, that lives at it's repo's root.
      </p>
      <p>Application Registry is implemented as a REST API server on NodeJS 4, ExpressJS 4, Swagger 2 and MongoDB 3.</p>

      <h5><a href="https://github.com/stjosephcontent/orchestra-reverse-proxy">Reverse Proxy</a></h5>
      <p>This is the only exposed container, exposing itself by default on port 80. It links out to as many apps as needed
         using standard docker linking. Those apps, in turn, may link out to dependant services (like databases), but the
         Reverse Proxy is only aware of the <em>ambasador</em> service (ie: the web server). When a new Application is deployed to a new Target, that target stops accepting connections on one instance of it's Reverse Proxy, drains any remaining connections, and spins up a new Reverse Proxy with the newly added Application linked in. This should all happen in a failure tolerant, zero-downtime way</p>

      <h5><a href="https://github.com/stjosephcontent/dogs">dogs</a></h5>
      <p>
         The Orchestra repository contains two trivial tutorial projects as Github submodules, Colours and Dogs. The respositories can used to try out SJC-CLI by spinning up/down projects based on Git branches.
      </p>
      
      <h5><a href="https://github.com/stjosephcontent/colours">colours</a></h5>
      <p>
         see above
      </p>
      <!--
      <h5>Shelbot</h5>
      <p>This is the robotic identity that performs actions on user's behalf. It has SSH access to Target machines, a github (or gitlab) account, and PGP keys for transfering encrypted information to and from Orchestra users</p>
      -->

      <h3>Getting Started</h3>
      <p>
         Some primary dependencies include:
         <ul>
            <li>NodeJS 4.x</li>
            <li><a href="http://kmkeen.com/jshon/">jshon</a></li>
            <li>Docker Machine (if you are on OS X, Windows support comming soon!)</li>
         </ul>
      </p>

      <h4>OSX and Linux</h4>
      <p>run this command to download the CLI to <code>~/.sjc/cli</code></p>

<pre><code>$ curl https://raw.githubusercontent.com/stjosephcontent/sjc-cli/master/install.sh | bash
</code></pre>

      <p>Now install the Reverse Proxy to <code>~/.sjc/cli</code>:</p>

<pre><code>$ curl https://raw.githubusercontent.com/stjosephcontent/orchestra-reverse-proxy/master/install.sh | bash
</code></pre>

      <p>The proxy needs to run as a privileged user because it's going to open port 80 and write to <code>/etc/hosts</code></p>

<pre><code>$ bash ~/.sjc/reverseproxy/run.sh
</code></pre>

      <p>Output from the proxy will stream to that console, so you'll need to open another one to start running commands. So don't worry if this command looks stuck. It's not. Leave that console as is, and open a new one to run some more commands.</p>

      <p>This system expects your docker-machine to be called "dev". so either create a new machine with the virtualbox driver called "dev", or alter <code>~/.sjc/cli/src/config.json</code> to point to your machine.</p>

      <p>Try: </p>

<pre><code>$ sjc ls
</code></pre>

      <p>You should get an empty response, indication that CLI is working, but no apps are running. That's not very much fun, so let's go ahead and clone dogs:</p>

<pre><code>$ git clone https://github.com/stjosephcontent/dogs
$ cd dogs
$ sjc start --hard
$ sjc ls
</code></pre>

      <p>Ah very good! Our first SJC app. Let's create another:</p>

<pre><code>$ git checkout poodle
$ sjc start --hard
$ sjc ls
</code></pre>

      <p>Now we're cooking with gas! Open them up in your browser: <code>sjc browse 1</code> or <code>sjc browse 2</code>.</p>

      <p>How cool is that? You should also try using this REPO for more variants and more fun: <a href="https://github.com/stjosephcontent/colours">https://github.com/stjosephcontent/colours</a></p>

      <p>For more info, <code>sjc help</code>.</p>

      <p>Note that this app is in alpha. You almost certainly will run up against bugs. But we intend to improve and support this as a long-term project, with the support of our company, <a href="http://stjoseph.com">St Joseph Communications</a>. Also, we will totally dogfood Orchestra internally.</p>

      <h4>Windows</h4>
      <p>We beleive in supporting Windows. Windows support is comming soon.</p>

      <h3>Vote!</h3>
      <p>This project is part of <a href="https://www.docker.com/community/hackathon">Docker Global Hack Day #3</a>. If you want (and we would love you for it) you can <a href="https://www.docker.com/community/hackathon">vote on it</a></p>

      <h3>Obligatory "We're Hiring" spot</h3>
      <p>If (and only if) you are smart and passionate, <a href="http://stjoseph.com/careers/">hit us up!</a></p>

      <footer class="site-footer">
         <span class="site-footer-owner"><a href="https://github.com/stjosephcontent/orchestra">Orchestra</a> is maintained by <a href="https://github.com/stjosephcontent">stjosephcontent</a>.</span>. 
         <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

   </section>
   <script type="text/javascript">
      var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
      document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
   </script>
   <script type="text/javascript">
      try {
         var pageTracker = _gat._getTracker("UA-67597001-1");
         pageTracker._trackPageview();
      } catch (err) { }
   </script>
</body>
</html>